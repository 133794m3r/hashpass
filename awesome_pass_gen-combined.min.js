/*
* Awesome Password Generator aka HashPass
* Copyright (c) 133794m3r aka Macarthur Inbody 2011-2019
* https://github.com/133794m3r/hashpass
* AGPLv3
*/
"use strict"
var perc=0;
function generate_salt(a,b,d,e,c){e=void 0===e?!1:e;c=void 0===c?!1:c;Date.now();var g=7,f=6,h=9,k=8;1==e&&!1===c?(a=scrypt(a,d,{log_n:g,r:f,p:1,encoding:"base64"}),b=scrypt(b,a,{log_n:g,r:f,p:1,encoding:"hex"}),d=scrypt(d,b,{log_n:g,r:f,p:1,encoding:"base64"})):(!0===c&&(g=f=9,h=12,k=14),f+=1,k+=1,a=ucrypt(a,d,{log_n:g,r:f,p:1,encoding:"base64"}),b=ucrypt(b,a,{log_n:g,r:f,p:1,encoding:"hex"}),d=ucrypt(d,b,{log_n:g,r:f,p:1,encoding:"base64"}));c=d+a+b;a=b+d+a;c=!0===e?scrypt(c,a,{log_n:h,r:k,p:1,
encoding:"hex"}):ucrypt(c,a,{log_n:h,r:k,p:1,encoding:"hex"});Date.now();return c}
function simplify(a,b,d,e){e=Date.now();var c=a.replace(/[^0-9]/g,""),g="";a=a.replace(/[^a-z]/g,"");var f=a.substr(1);var h=f=no_repeat_strings(f);f=a.substr(0,1).toUpperCase();var k=c.substr(0,1);c=c.substr(1);c=no_repeat_strings(c);var m=parseInt(c.substr(0,2))%3;var l=c.length;if(!1===d)switch(m){case 0:g="$";break;case 1:g="#";break;case 2:g="@"}else g=5<=l?c.substr(-1,1):h.substr(-1,1);d=round(b/2);b-d-1<=l&&(h=h.substr(0,d-2),c=c.substr(0,b-d-1));b-3-(b-d-1)<=l?(h=h.substr(0,b-d-1),c=c.substr(0,
d-2)):(h=h.substr(0,b-l-3),c.substr(0));switch((a.charCodeAt(1)+a.charCodeAt(1)+a.charCodeAt(2))%10){case 0:a=f+k+h+c+g;break;case 1:a=g+c+f+h+k;break;case 2:a=k+g+f+c+h;break;case 3:a=f+c+g+h+k;break;case 4:a=c+f+h+g+k;break;case 5:a=c+f+k+h+g;break;case 6:a=g+c+h+k+f;break;case 7:a=c+g+h+f+k;break;case 8:a=h+c+g+f+k;break;case 9:a=k+h+c+g+f}b=Date.now();console.log("pass "+a);console.log("pass_len "+a.length);console.log("simplify:"+(b-e)+"ms");return a}
function generate_pass(a){a=void 0===a?!1:a;document.getElementsByTagName("input");var b=[],d=select_by_id("no_spec").checked,e=select_by_id("no_legacy").checked,c=select_by_id("no_security").checked;var g=select_by_id("site_name").value;var f=select_by_id("password").value;var h=select_by_id("username").value;var k=select_by_id("length").value;b[0]=h;b[1]=g;""===k&&(k=14,select_by_id("length").value=14);if(""!==f){var m=f.length;f=f.substr(0,1).toUpperCase()+f.substr(1,m);select_by_id("password").value=
f}""!==h&&(h=h.substr(0,1).toUpperCase()+h.substr(1),select_by_id("username").value=h);""!==g&&(g=g.substr(0,1).toUpperCase()+g.substr(1),select_by_id("site_name").value=g);var l=zxcvbn(f,b);m=l.feedback.warning;console.log(l.guesses);console.log(m);m="Try adding a word or two, less common words are better. Or try adding a few numbers. "+m;var n=l.score;if(0===n){var p="red";var q="Unsafe";document.getElementById("orig_score_txt").setAttribute("style","color: red; font-weight:bold;")}else 1===n?(p=
"orange",q="Bad"):2===n?(p="yellow",q="Acceptable"):3===n?(p="yellowgreen",q="Safe"):(p="green",q="Perfect");select_by_id("orig_score_txt").setAttribute("style","color: white; font-weight:bold;");select_by_id("orig_score_txt").innerHTML=n;var r=23.75*n;select_by_id("low_score_warn").setAttribute("style","margin-left:29%; background-color:black; color:"+p);select_by_id("low_score_warn").innerHTML=q;select_by_id("orig_score_bar").setAttribute("style","width:"+r+"%; background-color:"+p);1>=l.score&&
(b[0]===b[1]||b[0]===f||b[1]===f)?select_by_id("feedback").innerHTML="Do not use your username or site name in the password! "+m:2>=l.score?select_by_id("feedback").innerHTML=m:select_by_id("feedback").innerHTML="Score is 3 or above and thus suggestions not necessary";b=Date.now();g=generate_salt(f,h,g,e);h=Date.now();!0===e?(select_by_id("orig_time").innerHTML=display_time(l.guesses/1300),f=scrypt(f,g,16,6,2,32,"binary")):!1===c?(select_by_id("orig_time").innerHTML=display_time(l.guesses/1300),f=
ucrypt(f,g,16,12,1,32,"binary"),select_by_id("length").value=14):(select_by_id("orig_time").innerHTML=display_time(l.guesses/1300),k++,f=ucrypt(f,g,17,14,1,32,"binary"));l=Date.now();console.log("scrypt time:"+(l-h)+"ms");f=base32_encode(f,!1);console.log("scrypt:"+f);f=simplify(f,k,d,e);select_by_id("result").value=f;k=Date.now();l=k-b;console.log("total:"+(k-b)+"ms");!0===a&&alert("total new values:"+l);b=Date.now();l=zxcvbn(f);k=Date.now();console.log("zxcvbn:"+(k-b)+"ms");n=l.score;console.log("b "+
n);p="green";r=23.75*n;select_by_id("gen_score_txt").innerHTML=n;select_by_id("gen_score_bar").setAttribute("style","width:"+r+"%; background-color:"+p);select_by_id("gen_time").innerHTML=display_time(l.guesses/9E3);modal_toggle("_progress");select_by_id("generate_pass").disabled=!1}function percent_update(a){var b=select_by_id("completed_perc"),d=select_by_id("perc_text"),e=select_by_id("perc_done");a+="%";d.innerHTML=a;e.innerHTML=a;b.style.width=a}
function modal_toggle(a){a=select_by_id("modal"+a);a.style.visibility="visible"===a.style.visibility?"hidden":"visible";return 0}function no_spec_check(){!0===select_by_id("no_spec").checked&&modal_toggle("_spec");return 0}function no_legacy_check(){!0===select_by_id("no_legacy").checked&&modal_toggle("_legacy");return 0}function change_security_mode(){!0===select_by_id("no_security").checked&&modal_toggle("_security");return 0}
function confirmed(a,b){select_by_id("no"+b).checked=a;modal_toggle(b);return 0}function generate_wrapper(a){a=void 0===a?!1:a;setTimeout(function(){select_by_id("modal_progress").style.visibility="visible"},0);setTimeout(function(){select_by_id("generate_pass").disabled=!0},1);setTimeout(function(){percent_update(70)},2);setTimeout(function(){generate_pass(a)},45)}
function score_password(){select_by_id("no_legacy");var a=select_by_id("site_name").value,b=select_by_id("password").value,d=select_by_id("username").value;select_by_id("length");var e=zxcvbn(b,[]);""!==b&&(b=b.substr(0,1).toUpperCase()+b.substr(1),select_by_id("password").value=b);""!==d&&(d=d.substr(0,1).toUpperCase()+d.substr(1),select_by_id("username").value=d);""!==a&&(a=a.substr(0,1).toUpperCase()+a.substr(1),select_by_id("site_name").value=a);var c=e.score;var g=e.feedback.warning;if(0===c){var f=
"red";c="Unsafe";select_by_id("orig_score_txt").setAttribute("style","color: red; font-weight:bold;")}else 1===c?(f="orange",c="Bad"):2===c?(f="yellow",c="Acceptable"):3===c?(f="yellowgreen",c="Safe"):(f="green",c="Perfect");select_by_id("orig_score_txt").setAttribute("style","color: white; font-weight:bold;");g="Try adding a word or two, less common words are better. Or try adding a few numbers. "+g;select_by_id("orig_score_txt").innerHTML=e.score;var h=23.75*e.score;select_by_id("orig_score_bar").setAttribute("style",
"width:"+h+"%; background-color:"+f);select_by_id("low_score_warn").setAttribute("style","margin-left:29%;color:"+f);select_by_id("low_score_warn").innerHTML=c;1>=e.score&&(d==b||a==b)?select_by_id("feedback").innerHTML="Do not use your username or site name in the password! "+g:2>=e.score?(console.log("hit"),select_by_id("feedback").innerHTML=g):select_by_id("feedback").innerHTML="Score is 3 or above and thus suggestions not necessary";select_by_id("orig_time").innerHTML=display_time(e.guesses/3E3)}
;function permute(a){function b(){for(var b=[],e=0;e<d;e+=1)b.push(a[c[e]]);return b}var d=a.length,e=[],c=[];e.push(0);c.push(0);for(var g=1;g<d;g+=1)e.push(-1),c.push(g);var f="string"!==typeof a?b:function(){return b().join("")};return function(){var a;for(a=0;a<d;a+=1)if(0!==e[a]){var b=a;break}if(void 0!==b){for(a=b+1;a<d;a+=1)0!==e[a]&&c[a]>c[b]&&(b=a);var g=b+e[b];a=b;b=c[a];c[a]=c[g];c[g]=b;b=e[a];e[a]=e[g];e[g]=b;if(0===g||g===d-1||c[g+e[g]]>c[g])e[g]=0;for(a=0;a<d;a+=1)c[a]>c[g]&&(e[a]=a<
g?1:-1);return f()}}}function select_by_id(a){return document.getElementById(a)};function pow(a,b){return Math.pow(a,b)}function sqrt(a){return Math.sqrt(a)}function ceil(a){return Math.ceil(a)}function getint(a){return parseInt(select_by_id(a).val())}function floor(a){return Math.floor(a)}function intval(a){return parseInt(a)}function rand(a,b){void 0===b&&(b=a,a=0);return Math.floor(Math.random()*(b-a))+a}function round(a,b){var d=0;void 0!==b&&(d=parseFloat(a.toFixed(b)));a=Math.round(a,5);return d!==a&&void 0!==b?parseFloat(d):parseInt(a)}
function mean(a){var b=a.length,d,e=0;for(d=0;d<b;++d)e+=a[d];return round(e/b,8)}function standard_deviation(a,b){var d=a.length,e,c=0;for(e=0;e<d;++e)c+=pow(a[e]-b,2);return c=round(sqrt(c/d),8)}function randfloat(a,b,d){var e=Math.pow(10,d);a+=(b-a)*(rand(0,e)/e);return a=round(a,d)}function sum(a,b,d,e){for(var c;b<d;++b)c+=eval(e),++a}function num_format(a){var b=(a+"").split(".");a=b[0];b=1<b.length?"."+b[1]:"";for(var d=/(\d+)(\d{3})/;d.test(a);)a=a.replace(d,"$1,$2");return a+b}
function float_bin(a){var b=a.split(".");var d=parseFloat("0."+b[1]),e=1;a=0;1<Math.abs(b[0])?(b=Math.abs(b[0]).toString(2),a=b.length,b+="."):b="0.";for(;0!==e&&24>a;)e=d*=2,e=Math.floor(e),b+=e,d+="",e=d.split("."),e=parseInt(e[1]),++a;d=b.split(".");a=0==parseInt(d[0])?d[0].length:d[1].length;for(d=0;d<a;++d);}function bin_float(a){}
function xor_rand(a,b){var d=window.screenX^window.screen.width;var e=window.screenY^window.screen.height;Math.rand();var c=Math.floor(4294967295*Math.rand());c=(c^c<<1)>>3;c^=c<<10;d^=d<<16;var g=d>>5^d<<1;e=(e^e>>2)<<5;e^=e>>15;var f=(c&6)+(d&6)+(e&6)+(g&6)+3,h;for(h=0;h<f;++h)c^=c<<1,c>>=3,c^=c<<10,d^=d<<16,g=d>>5,g^=d<<1,e^=e>>2,e<<=5,e^=e>>15;f*=2;for(h=0;h<f;++h){var k=d^d<<20^e^e>>11^g^g<<27^c^c>>6;d=e;e=g;g=c;c=k}return a||b?Math.floor(c*(b-a))+a:c&4294967295}
function microtime(){return Date.now()/1E3}function display_time(a){var b;a=1>a?[null,"less than a second"]:60>a?(b=Math.round(a),[b,b+" second"]):3600>a?(b=Math.round(a/60),[b,b+" minute"]):86400>a?(b=Math.round(a/3600),[b,b+" hour"]):2678400>a?(b=Math.round(a/86400),[b,b+" day"]):32140800>a?(b=Math.round(a/2678400),[b,b+" month"]):321408E4>a?(b=Math.round(a/32140800),[b,b+" year"]):[null,"centuries"];b=a[0];a=a[1];null!=b&&1!==b&&(a+="s");return a};function base32_encode_old(a){var b="",d=Math.floor(a.length/5),e=a.length%5,c,g="";0!=e&&(d+=1);for(c=0;c<d;c++){var f=a.charCodeAt(5*c);var h=a.charCodeAt(5*c+1);var k=a.charCodeAt(5*c+2);var m=a.charCodeAt(5*c+3);var l=a.charCodeAt(5*c+4);var n=f>>3;f=(f&7)<<2|h>>6;var p=(h&63)>>1;h=(h&1)<<4|k>>4;k=(k&15)<<1|m>>7;var q=(m&127)>>2;m=(m&3)<<3|l>>5;l&=31;b+="ybndrfg8ejkmcpqxot1uwisza345h769".charAt(n)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(f)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(p)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(h)+
"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(k)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(q)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(m)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(l)}a=0;1==e?a=6:2==e?a=4:3==e?a=3:4==e&&(a=1);e=8*c;for(c=0;c<a;c++)g+="=";return b=b.substr(0,e-a)+g}
function base32_encode(a,b){var d="",e=Math.floor(a.length/5),c=a.length%5,g="";0!=c&&(e+=1);if(!0===(void 0===b?!0:b))for(b=0;b<e;b++){var f=5*b;var h=a.charCodeAt(f);var k=a.charCodeAt(f+1);var m=a.charCodeAt(f+2);var l=a.charCodeAt(f+3);var n=a.charCodeAt(f+4);f=h>>3;h=(h&7)<<2|k>>6;var p=(k&63)>>1;k=(k&1)<<4|m>>4;m=(m&15)<<1|l>>7;var q=(l&127)>>2;l=(l&3)<<3|n>>5;n&=31;d+="ybndrfg8ejkmcpqxot1uwisza345h769".charAt(f)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(h)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(p)+
"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(k)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(m)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(q)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(l)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(n)}else for(b=0;b<e;b++)f=5*b,h=a[f],k=a[f+1],m=a[f+2],l=a[f+3],n=a[f+4],f=h>>3,h=(h&7)<<2|k>>6,p=(k&63)>>1,k=(k&1)<<4|m>>4,m=(m&15)<<1|l>>7,q=(l&127)>>2,l=(l&3)<<3|n>>5,n&=31,d+="ybndrfg8ejkmcpqxot1uwisza345h769".charAt(f)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(h)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(p)+
"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(k)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(m)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(q)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(l)+"ybndrfg8ejkmcpqxot1uwisza345h769".charAt(n);a=0;1==c?a=6:2==c?a=4:3==c?a=3:4==c&&(a=1);c=8*b;for(b=0;b<a;b++)g+="=";return d=d.substr(0,c-a)+g}function hex_decode(a){var b=Math.ceil(a.length/2),d,e="";for(d=0;d<b;d++)e+=String.fromCharCode(parseInt(a.substr(2*d,2),16));return e}
function string_indexes(a,b){for(var d,e=0,c=[],g=0,f=0;null!==e;)d=a.substr(e),e=d.match(b),null!==e&&(c[f++]=d.indexOf(e[0])+g,g=e=d.indexOf(e[0])+1+g);return c}
function no_repeat_strings(a){for(var b="",d=a.length,e="",c=a.substr(0,1),g,f=1,h=1,k=0,m=0,l=0;1===f;)h>d&&1<=k&&100>=m?(l=l+h+m,h=1,a=b+e,a.substr(-1,1)===a.substr(-2,1)?(b=l%d,a=a.substr(0,b)+a.substr(-1,1)+a.substr(b,d-1)):a.substr(0,1)===a.substr(1,1)&&(b=l%d,a=a.substr(0,b)+a.substr(-1,1)+a.substr(b,d-1)),c=a.substr(0,1),k=0,f=1,b=e="",m+=1):h>d&&(f=0),g=a.substr(h,1),c==g?(b+=c,k=b.length):e+=c,c=g,h+=1;return a}
function b64_encode(a,b){var d,e="",c=[],g=0,f=d=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("");if(0==(void 0===b?!1:b))for(;b=a.charCodeAt(d++);)128>b?c[f]=b:(2048>b?c[f]=192|b>>6:(65536>b?c[f]=224|b>>12:(c[f]=240|b>>18,c[f]=128|b>>12&63),c[f]=128|b>>6&63),c[f]=128|b&63),++f;else c=a,f=c.length;for(console.log(c);g<f;)a=c[g++],d=c[g++],b=c[g++],e+=h[a>>2],e+=h[(a&3)<<4|d>>4],e+=h[void 0===d?64:(d&15)<<2|b>>6],e+=h[void 0===b?64:b&63];return e}
function b64_decode(a){for(var b,d,e,c,g=0,f=a.length,h=[],k;g<f;)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g+1)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(g+2,1),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(g+3,1),b=b<<2|d>>4,d=(d&15)<<4|e>>2,k=(e&3)<<6|NaN,h+=String.fromCharCode(b),64!==e?h+=String.fromCharCode(d):
64!==c&&(h+=String.fromCharCode(k)),++g;return h=unescape(h)};
